# Standard Go Project Layout 重点整理

## 核心定位

* 非官方标准，是 Go 生态中新老项目通用的布局模式集合，部分模式更受欢迎。
* 非必需：小型项目（如学习、PoC、玩具项目）无需使用，从`main.go`起步即可；项目增长后需注重结构，多人协作或开源时需明确私有代码（`internal`）。
* 灵活取舍：克隆后保留所需内容，无需全用，甚至`vendor`模式也非通用。

## Go Modules 关键提示

* 推荐使用：Go 1.14 + 的 Go Modules 可投入生产，无需关注`$GOPATH`及项目位置。
* 模块路径：可自定义，首个组件最好含点（旧版本可能强制），`go.mod`默认假定托管于 Github 但非必需。
* 国内代理：七牛云提供国内可用的模块代理（默认代理可能被墙）。

## 核心目录说明

### 1. Go 核心目录


| 目录        | 用途及重点                                                                                                                      |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------- |
| `/cmd`      | 项目主干，存放可执行文件对应目录（如`/cmd/myapp`），代码应尽量简洁，主要导入`internal`/`pkg`的代码。                            |
| `/internal` | 私有代码（Go 编译器强制不可被外部导入），可在任意层级创建；可细分`/internal/app`（应用代码）和`/internal/pkg`（内部共享代码）。 |
| `/pkg`      | 外部可复用的公共库（如`/pkg/mypubliclib`），需谨慎存放（他人会依赖）；适合根目录非 Go 组件多的项目，小型项目可省略。            |
| `/vendor`   | 依赖项目录，由`go mod vendor`生成；构建库时不提交依赖，Go 1.13 + 模块代理可用时可省略。                                         |

### 2. 服务 / 应用目录


| 目录           | 用途及重点                                                                         |
| -------------- | ---------------------------------------------------------------------------------- |
| `/api`         | 存放 OpenAPI/Swagger 规范、JSON 模式、协议定义等。                                 |
| `/web`         | Web 应用专属组件：静态资源、服务器模板、SPA 等。                                   |
| `/configs`     | 配置模板或默认配置（如 confd/consul-template 模板）。                              |
| `/scripts`     | 构建、安装、分析等脚本，保持根目录`Makefile`简洁。                                 |
| `/build`       | 打包和 CI 配置：容器、操作系统包配置（`/build/package`）、CI 脚本（`/build/ci`）。 |
| `/deployments` | 部署配置模板（docker-compose、k8s、terraform 等），部分项目称`/deploy`。           |
| `/test`        | 外部测试程序和数据，可建`/test/data`或`/test/testdata`（Go 忽略`.`/`_`开头目录）。 |

### 3. 其他目录

* `/docs`：设计和用户文档（非 godoc 生成）。
* `/tools`：项目支持工具（可导入`pkg`/`internal`代码）。
* `/examples`：应用或库的示例代码。
* `/third_party`：外部辅助工具、分叉代码（如 Swagger UI）。
* `/githooks`：Git 钩子配置。
* `/assets`：图像、徽标等资源。
* `/website`：非 Github Pages 的项目网站数据。

## 不应有的目录

* `/src`：多为 Java 背景开发者使用，易与 Go 工作空间的`src`混淆，导致路径冗余（如`/workspace/src/your_project/src/`），应避免。



# The Clean Architecture笔记

## 核心原则与目标

* **依赖规则**：软件按圈层组织，源码依赖只能指向内层，内层不可知晓外层的任何命名实体（函数、类、变量等）。
* **目标**：构建可测试、松耦合、易扩展的系统，使其独立于框架、UI 和数据库，实现清晰的关注点分离。

## 四层架构划分及职责


| 层次                 | 核心职责                                     | 应用特异性 | 业务特异性 |
| -------------------- | -------------------------------------------- | ---------- | ---------- |
| 领域层（最内层）     | 定义核心业务实体和通用业务规则，是系统的核心 | 无         | 有         |
| 用例层               | 实现应用特定的业务流程，编排领域实体交互     | 有         | 有         |
| 接口层               | 适配内外交互，将外部事件转换为内层操作       | 有         | 无         |
| 基础设施层（最外层） | 提供通用技术支持，实现接口层定义的底层接口   | 无         | 无         |

## 各层详细内容

![image.png](https://cdn.jsdelivr.net/gh/Spike782/note-gen-image-sync@main/1e4a161f-2b30-43ed-bb0a-33577a5125ea.png)

### 领域层

* **核心实体**：
  * `Customer`：包含`Id`、`Name`字段，代表客户。
  * `Item`：包含`Id`、`Name`、`Value`、`Available`字段，代表商品。
  * `Order`：包含`Id`、`Customer`、`Items`字段，代表订单，且有`Add`方法（实现业务规则）和`value`方法（计算订单总价值）。
* **业务规则**：
  * 不可添加不可用商品到订单。
  * 订单总价值不能超过 \$250。
* **接口定义**：`CustomerRepository`、`ItemRepository`、`OrderRepository`，定义了对实体的存储和查询操作，由接口层实现。

### 用例层

* **核心实体**：
  * `User`：包含`Id`、`IsAdmin`、`Customer`字段，关联客户，含权限标识。
  * 自定义`Item`：用于向外层提供数据，避免领域实体泄露。
* **接口定义**：`UserRepository`（用户的存储和查询）、`Logger`（日志记录）。
* **用例实现**：
  * `OrderInteractor`：处理普通用户添加商品到订单、查询订单商品等操作，包含`Items`和`Add`方法。
  * `AdminOrderInteractor`：处理管理员添加商品到订单的操作，包含`Add`方法。
* **特点**：通过依赖注入使用领域层接口和自身定义的接口，编排业务流程。

### 接口层

* **Web 服务**：`WebserviceHandler`处理 HTTP 请求，将请求参数转换后调用用例层接口，如`ShowOrder`方法。
* **Repository 实现**：
  * `DbUserRepo`、`DbCustomerRepo`、`DbOrderRepo`、`DbItemRepo`，实现领域层和用例层的 Repository 接口，处理数据库的 CRUD 操作。
  * 负责数据格式转换，如数据库中 "yes/no" 与布尔值的映射。
* **接口定义**：`DbHandler`（定义数据库执行和查询操作）、`Row`（定义行数据的扫描和下一行操作），由基础设施层实现。

### 基础设施层

* **核心实现**：`SqliteHandler`实现接口层的`DbHandler`接口，封装 SQLite 数据库连接和查询操作，包含`Execute`、`Query`方法等。
* **技术支持**：提供 HTTP 服务器、数据库驱动等底层技术支持，如使用`net/http`和`github.com/mattn/go-sqlite3`。

## 示例应用

* **功能**：简单的在线购物系统，支持通过 HTTP 查询订单商品。
* **组装方式**：在`main.go`中通过依赖注入组装各层，初始化基础设施（数据库连接）→ 接口层（Repository）→ 用例层（Interactor）→ 接口层（Web 服务），最终启动 HTTP 服务。
* **效果**：访问`http://localhost:8080/orders?userId=40&orderId=60`可获取对应订单的商品信息。

## 架构优势

* 各层解耦，更换数据库或 Web 框架时，只需修改接口层和基础设施层，不影响领域和用例层。
* 系统可测试性高，通过接口可方便地进行模拟测试。
* 便于扩展和维护，各层职责清晰，关注点分离。
